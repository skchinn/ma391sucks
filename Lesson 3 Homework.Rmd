---
title: "Lesson 3 - Optimization/Step Function"
author: "Samantha Chinn"
date: "1/14/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Chapter 1 Problems 4, 5, 6
## Problem 4(a)
How many additional crews should be brought in to minimize the total cost to the company? How much will the clean-up cost?
###Step 1: Ask the question
Variables/Facts:

* 200 mile oil spill to clean up
* $x$ = additional crews to hire
* $d$ = time it takes to clean up (days)
* $r$ = clean-up rate for a crew (miles/day)
* $C_1$ = cost of local cleanup crew (dollars) = $500d$
* $C_2$ = cost of $x$ additional crews (dollars) = $(18000+800d)x$
* $C_fine$ = cost of fines after 14 days = $10000(d-14)$ if d>14
* $C$ = total cost of clean-up = $C_1 + C_2 + C_fine$

Assumptions:

* days to complete clean-up are not affected by anything other than the number of crews and the rate (weather, etc): $d = \frac{200}{r(x+1)}$
* cost for fines are only levied after 14 days - becomes a step function
* all of the crews clean-up the spill at the same rate as the local crew $r - 5/$ (miles/day)


###Step 2: Select the modeling approach
Single Variable Optimization

###Step 3: Formulate the model
```{r}
## Define the function using boolean statements such as >, <=, == 
# Given: 5 miles of beach per week
r = 5/7 
# Define the function
fT = function(x){500*(200/(r*(x+1)))+(18000+800*200/(r*(x+1)))*x+(200/(r*(x+1))>14)*(10000*(200/(r*(x+1))-14))} 
# Define the derivative
dfT = function(x){fprime(fT,x)}
# Define the domain to graph on
x = seq(0,20,1)
# Plot the function
plot(x,fT(x),type="o")
```
The number of additional crews to be brought in to minimize cost appears to be somewhere around 11.
```{r}
# Print the value that I estimate to be the minimum cost
print(fT(11))
```
The minimum cost with that crew appears to be around $508,333.30
###Step 4: Solve the model
```{r}
# Verify by actually solving the problem using the bisection method
## Bisection

bisection = function(f,a,b,tol=0.0001){
  if (f(a)*f(b) > 0){
    return ("Boundary Conditions Not Met")
  }
  else{
    middle = a
    while (abs(f(middle))>tol){
      middle = (a+b)/2
      if (f(middle)*f(a)>0) (a = middle)
      else (b = middle)
      x=middle
      y=f(middle)
      ## if you want to "see" what happens at every step, take off the # of the next line ##
      #cat(sprintf("x-Val: %.4f ; f(x-val): %.4f\n",x,y))
    }
    return (middle)
  }
}
## F-Prime
fprime = function (f,a,h=0.0001){(f(a+h)-f(a-h))/(2*h)}
ans = bisection(dfT,0,20)
print(ans)
```
My estimate was right, the number of additional crews for minimum cost is 11.28368.
```{r}
# Plug ans back into function to find the minimum cost
print(fT(ans))
```
The minimum cost of the clean-up is $508,212.60.
###Step 5: Answer the question
Additional Crews: 11.28368  
Clean-up Cost: $508,212.60

## Problem 4(b)
Examine the sensitivity to the rate at which a crew can clean up the shoreline, $r$. Consider both the optimal number of crews and the total cost to the company.
```{r}
ans.crew=0
ans.cost=0
ans.cost1 <- na.omit(ans.cost)
r = seq(2/7,8/7,1/7)
for (i in 1:length(r)){
  ## Change r to the variable r[i] to iterate the changing rate
  fT = function(x){return(500*(200/(r[i]*(x+1)))+(18000+800*200/(r[i]*(x+1)))*x+(200/(r[i]*(x+1))>14)*(10000*(200/(r[i]*(x+1))-14)))}
  dfT = function(x){fprime(fT,x)}
  ans.crew[i] = bisection(dfT,0,20)
  ans.cost1[i] = fT(ans.crew[i])
}
  result = data.frame(rate = r, crew = ans.crew, cost = ans.cost1)
  print(result)
```
As rate increases from $2/7$ to $8/7$ the amount of crew needed decreases as well as the cost. I chose the values for $r$ based on the rate with optimal crew numbers for minimal cost.
As the rate increases, the crew decreases and the cost decreases.
## Problem 4(c)
Examine the sensitivity to the amount of the fine. Consider the number of days the company will take and the total cost to the company.
```{r}
ans.days=0
ans.cost=0
ans.cost1 <- na.omit(ans.cost)
f = seq(0,50000,10000)
for (i in 1:length(f)){
  ## Change the fine part of the function to the variable f[i] to iterate the changing fines
  r=5/7
  fT = function(x){return(500*(200/(r*(x+1)))+(18000+800*200/(r*(x+1)))*x+(200/(r*(x+1))>14)*f[i])}
  dfT = function(x){fprime(fT,x)}
  ans.days[i] = bisection(dfT,14,10000)
  ans.cost1[i] = fT(ans.days[i])
}
  result = data.frame(fine = f, days = ans.days, cost = ans.cost1)
  print(result)
```
This code will not run because the derivative of the function will never equal zero. Keep getting an error message.

## Problem 4(d)
The company thinks the amount of fine is excessive. Assuming the only purpose of the fine is to motivate the clean-up, is the fine excessive?
I think it is fine, they provide a reasonable amount of time in the first place to get the clean-up done.




\newpage





#Problem 5(a)
What level of effort will maximize the sustained harvest rate?
##Step 1: Ask the question
Variables/Facts:

* $R$ = growth rate of the fin whale population (per year)
* $r$ = intrinsic growth rate = $0.08$
* $K$ = maximum sustainable population = $400,000$
* $x$ = current population, $x_0$ = $70,000$
* $H$ = number of whales harvested per year = $0.00001*E*x$
* $E$ = level of fishing effort in boat-days

Assumptions:

* growth rate is constant
* whale harvest rate only depends on $E$ and $x$

###Step 2: Select the modeling approach
Single Variable Optimization

###Step 3: Formulate the model
```{r}
## Define the function using boolean statements such as >, <=, == 
# Given: r=0.08, K=400,000, x=70,000
r = 0.08
K = 400000
#x = 70000
# Define the function
fW = function(x){(r*x*(1-(x/K)))} 
# Define the derivative
dfW = function(x){fprime(fW,x)}
# Define the domain to graph on
x = seq(0,900000,100000)
# Plot the function
plot(x,fW(x),type="o")
```
The level of Effort to maximize the sustained harvest rate appears to be around 200,000.
```{r}
# Print the value that I estimate to be the maximum harvest rate.
print(fW(200000))
```
The maximum sustained harvest rate is around 8,000.
###Step 4: Solve the model
```{r}
# Verify by actually solving the problem using the bisection method
## Bisection

bisection = function(f,a,b,tol=0.0001){
  if (f(a)*f(b) > 0){
    return ("Boundary Conditions Not Met")
  }
  else{
    middle = a
    while (abs(f(middle))>tol){
      middle = (a+b)/2
      if (f(middle)*f(a)>0) (a = middle)
      else (b = middle)
      x=middle
      y=f(middle)
      ## if you want to "see" what happens at every step, take off the # of the next line ##
      #cat(sprintf("x-Val: %.4f ; f(x-val): %.4f\n",x,y))
    }
    return (middle)
  }
}
## F-Prime
fprime = function (f,a,h=0.0001){(f(a+h)-f(a-h))/(2*h)}

ans = bisection(dfW,100000,300000)
print(ans)
```
I was correct in my guess that the maximum population is 200,000.

```{r}
# Plug ans back into function to find the optimal harvest rate
print(fW(200000))
```
###Step 5: Answer the question
The optimal harvest rate is 8,000 whales/year.

## Problem 5(b)
Examine the sensitivity to the intrinsic growth rate. Consider the optimum level of effort and the resulting population level.
```{r}
ans.effort=0
ans.popn=0
#ans.cost1 <- na.omit(ans.cost)
r = seq(0,.15,.01)
for (i in 1:length(r)){
  ## Change r to the variable r[i] to iterate the changing rate
  fW = function(x){return(r[i]*x*(1-(x/K)))}
  dfW = function(x){fprime(fW,x)}
  ans.effort[i] = bisection(dfW,150000,250000)
  ans.popn[i] = fW(ans.effort[i])
}
  result = data.frame(rate = r, effort = ans.effort, population = ans.popn)
  print(result)
```
As the intrinsic growth rate increases by 1% the effort level remains the same and the resulting population increases by 1000 whales.

## Problem 5(c)
Examine the sensitivity to the maximum sustainable population. Consider the optimum level of effort and the resulting population level.
```{r}
ans.effort=0
ans.popn=0
K = seq(0,800000,100000)
for (i in 1:length(K)){
  ## Change K to the variable [i] to iterate the changing rate
  fW = function(x){return(0.08*x*(1-(x/K[i])))}
  dfW = function(x){fprime(fW,x)}
  ans.effort[i] = bisection(dfW,0,1000000)
  ans.popn[i] = fW(ans.effort[i])
}
  result = data.frame(maxsust= K, effort = ans.effort, population = ans.popn)
  print(result)
```

As the maximum sustainable population increases from 0 to 800,000 the effort level and resulting population remain the same.

\newpage

#Problem 6(a)
What level of effort will maximize profit over the long term?
##Step 1: Ask the question
Variables/Facts:

* $C$ = cost of whaling (dollars/day) = $500$ 
* $F$ = price of fin whale carcass (dollars) = $6,000$
* $R$ = revenue (dollars/year)
* $P$ = profit (dollars/year)

Assumptions:

* cost of whaling and price of fin whale carcass will remain constant
* $P = R - C$
* $R$ = $6000*H$
* 

###Step 2: Select the modeling approach
Single Variable Optimization

###Step 3: Formulate the model
```{r}
## Define the function using boolean statements such as >, <=, == 
# Given: 

# Define the function
fG = function(x){-0.0012*(x^2)+490*x-4000000} 
# Define the derivative
dfG = function(x){fprime(fG,x)}
# Define the domain to graph on
x = seq(0,250000,10000)
# Plot the function
plot(x,fG(x),type="o")
```
We see the maximum is around 200,000.

###Step 4: Solve the model
```{r}
# Verify by actually solving the problem using the bisection method
## Bisection

bisection = function(f,a,b,tol=0.0001){
  if (f(a)*f(b) > 0){
    return ("Boundary Conditions Not Met")
  }
  else{
    middle = a
    while (abs(f(middle))>tol){
      middle = (a+b)/2
      if (f(middle)*f(a)>0) (a = middle)
      else (b = middle)
      x=middle
      y=f(middle)
      ## if you want to "see" what happens at every step, take off the # of the next line ##
      #cat(sprintf("x-Val: %.4f ; f(x-val): %.4f\n",x,y))
    }
    return (middle)
  }
}
## F-Prime
fprime = function (f,a,h=0.0001){(f(a+h)-f(a-h))/(2*h)}

ans = bisection(dfG,0,300000)
print(ans)
```
```{r}
# Plug ans back into function to find the maximum
print(fG(ans))
```
###Step 5: Answer the question
Level of Effort: 8,000
Population: 204,167
Profit: $46,020,833

##Problem 6(b)
Examine the sensitivity to the cost of whaling. Consider the eventual profit in $/year and the level of effort.
```{r}
w=500
ans.prof=0
ans.effort=0
C = seq(2/7,8/7,1/7)
for (i in 1:length(r)){
  ## Change r to the variable r[i] to iterate the changing rate
  fT = function(x){return(-0.0012*(x^2)+(480+.02*w)*x-8000*w)}
  dfT = function(x){fprime(fT,x)}
  ans.prof[i] = bisection(dfT,0,100000)
  ans.effort[i] = fT(ans.crew[i])
}
  result = data.frame(cost = C, profit = ans.prof, effort = ans.effort)
  print(result)
```

##Problem 6(c)
Examine the sensitivity to the price of a fin whale carcass. Consider profit and level of effort.
```{r}
w=500
ans.prof=0
ans.effort=0
F = seq(2/7,8/7,1/7)
for (i in 1:length(r)){
  ## Change F to the variable F[i] to iterate the changing fin whale carcass price
  fT = function(x){return(-0.0012*(x^2)+(480+.02*w)*x-8000*w)}
  dfT = function(x){fprime(fT,x)}
  ans.prof[i] = bisection(dfT,0,100000)
  ans.effort[i] = fT(ans.crew[i])
}
  result = data.frame(fin = F, profit = ans.prof, effort = ans.effort)
  print(result)
```

##Problem 6(d)
The cost per boat/day is 500 and the cost of one carcass is 6,000. So if they get one whale they have already made 12 times as much money as the boat costs.